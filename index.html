<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –ü—Ä–æ–µ–∫—Ü–∏–∏ (–ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è –≤–µ—Ä—Å–∏—è)</title>
    <style>
        /* CSS –ö–û–î */
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 20px; background: #f0f2f5; color: #1c1e21; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; }
        .header { background: #1877f2; color: white; padding: 24px 30px; text-align: center; }
        .header h1 { margin: 0; font-size: 24px; }
        .progress-bar { background: rgba(255,255,255,0.3); height: 6px; border-radius: 3px; margin: 16px 0 8px; overflow: hidden; }
        .progress-fill { background: white; height: 100%; border-radius: 3px; transition: width 0.4s ease; }
        .step { padding: 32px 40px; border-bottom: 1px solid #dddfe2; display: none; }
        .step.active { display: block; }
        .step:last-child { border-bottom: none; }
        .step-header { display: flex; align-items: center; margin-bottom: 24px; }
        .step-number { background: #1877f2; color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 16px; flex-shrink: 0; }
        .step-header h2 { margin: 0; font-size: 20px; }
        .upload-zone { border: 2px dashed #ccd0d5; border-radius: 8px; padding: 50px 20px; text-align: center; cursor: pointer; transition: all 0.2s ease; margin: 20px 0; background: #f7f8fa; }
        .upload-zone:hover, .upload-zone.dragover { border-color: #1877f2; background: #e7f3ff; }
        .image-container { position: relative; display: inline-block; margin: 20px 0; border: 1px solid #dddfe2; border-radius: 8px; overflow: hidden; line-height: 0; }
        .image-container img { max-width: 100%; max-height: 500px; display: block; }
        .point { position: absolute; width: 14px; height: 14px; border: 3px solid white; border-radius: 50%; transform: translate(-50%, -50%); box-shadow: 0 2px 8px rgba(0,0,0,0.5); z-index: 10; }
        .point.contour-point { cursor: default; background: #333; border: 2px solid white; }
        .point.movable-point { cursor: move; }
        .point::after { content: attr(data-number); position: absolute; top: -28px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 3px 7px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .control-group { margin: 20px 0; }
        .control-group label { display: block; margin-bottom: 8px; font-weight: 600; }
        .form-control { width: 100%; box-sizing: border-box; padding: 10px 12px; border-radius: 6px; border: 1px solid #ccd0d5; font-size: 16px; }
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 15px; transition: all 0.2s ease; margin: 5px; }
        .btn-primary { background: #1877f2; color: white; }
        .btn-primary:hover { background: #166fe5; }
        .btn-success { background: #42b72a; color: white; }
        .btn-success:hover { background: #36a420; }
        .btn-danger { background: #fa3e3e; color: white; }
        .btn-danger:hover { background: #e03838; }
        .hidden { display: none; }
        .point-1 { background: #ff4444; } .point-2 { background: #4444ff; } .point-3 { background: #44ff44; } .point-4 { background: #ffff44; }
        #final-download-status { margin-top: 15px; font-weight: bold; color: #1877f2; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–†–µ–¥–∞–∫—Ç–æ—Ä –ü—Ä–æ–µ–∫—Ü–∏–∏</h1>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <span id="progressText">–®–∞–≥ 1 –∏–∑ 4</span>
        </div>

        <div class="step active" id="step1">
            <div class="step-header">
                <div class="step-number">1</div>
                <div><h2>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ–Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h2></div>
            </div>
            <div class="upload-zone" onclick="document.getElementById('bgInput').click()">üì∑ –ö–ª–∏–∫–Ω–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</div>
            <input type="file" id="bgInput" accept="image/*" class="hidden">
            <div id="bgImageContainer" class="image-container" style="display: none;"><img id="bgImage"></div>
            <button id="nextStep1" class="btn btn-primary" style="display: none;" onclick="nextStep(2)">–î–∞–ª–µ–µ ‚Üí</button>
        </div>

        <div class="step" id="step2">
            <div class="step-header">
                <div class="step-number">2</div>
                <div><h2>–†–∞–∑–º–µ—â–µ–Ω–∏–µ —Ç–æ—á–µ–∫ –∫–æ–Ω—Ç—É—Ä–∞ (4 —Ç–æ—á–∫–∏)</h2></div>
            </div>
            <div class="control-group">
                <span>–¢–æ—á–µ–∫ —Ä–∞–∑–º–µ—â–µ–Ω–æ: <span id="pointCount">0</span>/4</span>
                <button class="btn btn-danger btn-sm" onclick="clearContourPoints()">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div id="contourImageContainer" class="image-container"></div>
            <button id="nextStep2" class="btn btn-primary" style="display: none;" onclick="nextStep(3)">–î–∞–ª–µ–µ ‚Üí</button>
        </div>

        <div class="step" id="step3">
            <div class="step-header">
                <div class="step-number">3</div>
                <div><h2>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–µ–∫—Ü–∏–∏</h2></div>
            </div>
            <div class="upload-zone" onclick="document.getElementById('projInput').click()">üñºÔ∏è –ö–ª–∏–∫–Ω–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–µ–∫—Ü–∏–∏</div>
            <input type="file" id="projInput" accept="image/*" class="hidden">
            <div id="projPreview" style="margin: 20px 0;"></div>
            <button id="nextStep3" class="btn btn-primary" style="display: none;" onclick="nextStep(4)">–ü–µ—Ä–µ–π—Ç–∏ –∫ –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏–∏ ‚Üí</button>
        </div>

        <div class="step" id="step4">
             <div class="step-header">
                <div class="step-number">4</div>
                <div><h2>–§–∏–Ω–∞–ª—å–Ω–∞—è –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ</h2><p style="margin:4px 0 0; font-size:14px; color:#606770;">–°–æ–≤–º–µ—Å—Ç–∏—Ç–µ —Ü–≤–µ—Ç–Ω—ã–µ —Ç–æ—á–∫–∏ —Å —É–≥–ª–∞–º–∏ –∫–æ–Ω—Ç—É—Ä–∞ –Ω–∞ —Ñ–æ—Ç–æ</p></div>
            </div>
             <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 250px;">
                    <div class="control-group">
                        <label for="goboDiameter">–î–∏–∞–º–µ—Ç—Ä –ì–æ–±–æ –¥–ª—è –ø–µ—á–∞—Ç–∏ (–º–º):</label>
                        <input type="number" id="goboDiameter" value="37.5
