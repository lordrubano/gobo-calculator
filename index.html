<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>GOBO –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä-–†–µ–¥–∞–∫—Ç–æ—Ä 2.1</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#5a67d8">
    <style>
        html, body { margin: 0; padding: 0; font-family: sans-serif; background: #f0f2f6; color: #333; }
        h1, h2, h3 { text-align: center; margin: 10px 0; color: #2d3748; }
        #app { max-width: 960px; margin: 20px auto; padding: 16px; background: #fff; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
     .step { display: none; padding: 24px; border-radius: 12px; }
     .step.active { display: block; }
     .progress { display: flex; justify-content: space-between; margin: 16px 0 24px; padding-bottom: 10px; border-bottom: 1px solid #e2e8f0; }
     .progress div { flex: 1; text-align: center; font-weight: 700; color: #a0aec0; position: relative; padding: 5px; cursor: default; }
     .progress div::before { content: attr(data-n); display: block; width: 32px; height: 32px; margin: 0 auto 8px; border-radius: 50%; line-height: 32px; border: 2px solid currentColor; background: #fff; }
     .progress div.active { color: #5a67d8; }
     .progress div.done::before { background: #5a67d8; color: #fff; border-color: #5a67d8; }
        
        #photoZone { border: 3px dashed #cbd5e0; padding: 40px; text-align: center; border-radius: 10px; cursor: pointer; background: #f7fafc; margin-bottom: 16px; }
        #photoZone.dragover { background: #edf2f7; border-color: #5a67d8; }
        
     .image-container { position: relative; display: inline-block; border: 1px solid #e2e8f0; border-radius: 10px; overflow: hidden; max-width: 100%; margin: 0 auto; display: block; }
        #bgImg, #bgImgDeform { display: block; max-width: 100%; max-height: 60vh; border-radius: 9px; margin: 0 auto;}
        #deformation-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #svgOverlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
     .point-marker { position: absolute; width: 14px; height: 14px; background: #e53e3e; border: 2px solid #fff; border-radius: 50%; transform: translate(-50%, -50%); font-size: 9px; line-height: 10px; text-align: center; color: #fff; font-weight: 700; user-select: none; cursor: grab; box-shadow: 0 0 5px rgba(0,0,0,0.3); }
     .point-marker:active { cursor: grabbing; }

     .controls,.export-controls { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 16px; padding: 10px; background: #f9f9f9; border-radius: 8px; }
     .controls label,.export-controls label { font-size: 14px; display: flex; flex-direction: column; gap: 4px; }
     .controls input[type="range"] { width: 150px; }
     .controls input[type="number"] { width: 60px; padding: 4px; border-radius: 4px; border: 1px solid #ccc; }
        
        button, input[type="file"] { padding: 10px 15px; background-color: #5a67d8; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; transition: background-color 0.2s; }
        button:hover, input[type="file"]:hover { background-color: #434190; }
        button:disabled { background-color: #a0aec0; cursor: not-allowed; }
        input[type="file"] { display: block; margin-bottom:10px;}
        #goboPreview { min-height: 100px; border: 2px dashed #cbd5e0; margin: 12px 0; display: flex; align-items: center; justify-content: center; border-radius: 10px; background: #f7fafc; }
        #goboPreview img { max-height: 180px; max-width: 100%; }
     .hidden { display: none; }
        #notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: #333; color: white; padding: 10px 20px; border-radius: 5px; z-index: 1000; display: none; }
     .introjs-tooltip { font-family: sans-serif; } /* Basic styling for intro.js */
    </style>
    <script src="https://cdn.jsdelivr.net/npm/delaunator@5.0.1/delaunator.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/transformation-matrix-js@2.7.6/matrix.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-to-tiff@1.0.0/canvasToTIFF.min.js"></script>
</head>
<body>
    <div id="app">
        <h1>GOBO –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä-–†–µ–¥–∞–∫—Ç–æ—Ä 2.1</h1>
        <div class="progress">
            <div id="pStep1" data-n="1" class="active">1. –§–æ—Ç–æ</div>
            <div id="pStep2" data-n="2">2. –ö–æ–Ω—Ç—É—Ä</div>
            <div id="pStep3" data-n="3">3. –ì–æ–±–æ</div>
            <div id="pStep4" data-n="4">4. –î–µ—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
            <div id="pStep5" data-n="5">5. –≠–∫—Å–ø–æ—Ä—Ç</div>
        </div>

        <section id="step1" class="step active">
            <h2>–®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∫–∞ —ç—Ç–∞–ª–æ–Ω–Ω–æ–≥–æ —Ñ–æ—Ç–æ</h2>
            <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –æ–±—ä–µ–∫—Ç–∞ (—Å —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã–º –∏–ª–∏ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–º –∫–æ–Ω—Ç—É—Ä–æ–º) –≤ –æ–±–ª–∞—Å—Ç—å –Ω–∏–∂–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª.</p>
            <div id="photoZone">üì∑ –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ —Å—é–¥–∞ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
            <input id="photoInput" type="file" accept="image/*" class="hidden">
            <button id="setupAppFiles" style="margin-top: 15px; background-color: #f0ad4e;">–°–∫–∞—á–∞—Ç—å manifest.json –∏ sw.js (–¥–ª—è GitHub Pages)</button>
        </section>

        <section id="step2" class="step">
            <h2>–®–∞–≥ 2: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ—á–µ–∫ –∫–æ–Ω—Ç—É—Ä–∞</h2>
            <p>–ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ —É–≥–ª–∞–º –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–æ–≥–æ –∫–æ–Ω—Ç—É—Ä–∞ –Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (–º–∏–Ω–∏–º—É–º 3, –º–∞–∫—Å–∏–º—É–º 12 —Ç–æ—á–µ–∫). –¢–æ—á–∫–∏ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –¥–≤–∏–≥–∞—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ.</p>
            <div class="image-container" id="contourImageContainer">
                <img id="bgImg" alt="–≠—Ç–∞–ª–æ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ">
                <svg id="svgOverlay" xmlns="http://www.w3.org/2000/svg"></svg>
                </div>
            <div class="controls">
                <span>–¢–æ—á–µ–∫: <b id="pointCount">0</b>/12</span>
                <button id="undoLastPoint">‚¨ÖÔ∏è –û—Ç–º–µ–Ω–∏—Ç—å —Ç–æ—á–∫—É</button>
                <button id="clearPoints">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–æ—á–∫–∏</button>
                <button id="goToStep3" disabled>–î–∞–ª–µ–µ &rarr;</button>
            </div>
        </section>

        <section id="step3" class="step">
            <h2>–®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–æ–±–æ</h2>
            <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–æ–≥–æ—Ç–∏–ø), –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –ø—Ä–æ–µ—Ü–∏—Ä–æ–≤–∞—Ç—å—Å—è. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è PNG —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º —Ñ–æ–Ω–æ–º.</p>
            <input id="goboInput" type="file" accept="image/*">
            <div id="goboPreview"><span>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≥–æ–±–æ</span></div>
            <button id="goToStep4" disabled>–î–∞–ª–µ–µ &rarr;</button>
        </section>

        <section id="step4" class="step">
            <h2>–®–∞–≥ 4: –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏—è –≥–æ–±–æ</h2>
            <p>–ü–µ—Ä–µ–º–µ—â–∞–π—Ç–µ –∫—Ä–∞—Å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–º–µ—â–µ–Ω–∏—è –≥–æ–±–æ —Å –∫–æ–Ω—Ç—É—Ä–æ–º. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–∑—É–Ω–∫–∏ –¥–ª—è –æ–±—â–µ–π –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏.</p>
            <div class="image-container" id="deformationContainer">
                <img id="bgImgDeform" alt="–≠—Ç–∞–ª–æ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ –¥–ª—è –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏–∏">
                <canvas id="deformation-canvas"></canvas>
                </div>
            <div class="controls">
                <label>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å: <input type="range" id="opacitySlider" min="0" max="100" value="100"> <span id="opacityValue">100%</span></label>
                <label>–ú–∞—Å—à—Ç–∞–±: <input type="range" id="scaleSlider" min="10" max="300" value="100"> <span id="scaleValue">100%</span></label>
                <label>–ü–æ–≤–æ—Ä–æ—Ç: <input type="range" id="rotationSlider" min="-180" max="180" value="0"> <span id="rotationValue">0¬∞</span></label>
            </div>
             <div class="controls">
                <button id="toggleGoboVisibility">üëÅÔ∏è –°–∫—Ä—ã—Ç—å/–ü–æ–∫–∞–∑–∞—Ç—å –ì–æ–±–æ</button>
                <button id="undoTransform">‚¨ÖÔ∏è –û—Ç–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ</button>
                <button id="resetTransform">üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏</button>
                <button id="saveProject">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
                <button id="loadProjectInputLabel" onclick="document.getElementById('loadProjectInput').click();">üìÇ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
                <input type="file" id="loadProjectInput" class="hidden" accept=".json">
                <button id="runTour">‚ùì –ü–æ–º–æ—â—å</button>
                <button id="goToStep5">–î–∞–ª–µ–µ &rarr;</button>
            </div>
        </section>

        <section id="step5" class="step">
            <h2>–®–∞–≥ 5: –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏ —ç–∫—Å–ø–æ—Ä—Ç</h2>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø–µ—á–∞—Ç–∏ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.</p>
            <div class="export-controls">
                <label>–ü—Ä–µ—Å–µ—Ç –ø–µ—á–∞—Ç–∏:
                    <select id="printPreset">
                        <option value="custom">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π</option>
                        <option value="32,2700,3401">–°—Ç–µ–∫–ª–æ: 32–º–º @ 2700 DPI (3401px)</option>
                        <option value="37.5,600,886">–°–ª–∞–π–¥ 35–º–º: D=37.5–º–º @ 600 DPI (886px)</option>
                        <option value="37.5,1200,1772">–°–ª–∞–π–¥ 35–º–º: D=37.5–º–º @ 1200 DPI (1772px)</option>
                        <option value="50,600,1181">–°–ª–∞–π–¥ 50–º–º: D=50–º–º @ 600 DPI (1181px)</option>
                    </select>
                </label>
                <label>–î–∏–∞–º–µ—Ç—Ä –ø–µ—á–∞—Ç–∏ (–º–º): <input type="number" id="printDiameter" value="32" step="0.1"></label>
                <label>–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ (DPI): <input type="number" id="printDPI" value="2700" step="50"></label>
                <label>–†–∞–∑–º–µ—Ä –≤ –ø–∏–∫—Å–µ–ª—è—Ö: <input type="text" id="pixelSize" readonly></label>
            </div>
            <div class="controls">
                <button id="exportPNG">–≠–∫—Å–ø–æ—Ä—Ç –≤ PNG</button>
                <button id="exportTIFF">–≠–∫—Å–ø–æ—Ä—Ç –≤ TIFF (RGBA)</button>
            </div>
            <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —ç–∫—Å–ø–æ—Ä—Ç–∞:</h3>
            <canvas id="exportPreviewCanvas" style="border:1px solid #ccc; margin-top:10px; max-width: 100%;"></canvas>
        </section>
    </div>

    <div id="notification"></div>

    <script type="text/plain" id="manifest-data">
    {
      "name": "GOBO –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä-–†–µ–¥–∞–∫—Ç–æ—Ä",
      "short_name": "GOBO–†–µ–¥–∞–∫—Ç–æ—Ä",
      "description": "–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ü–∏–π –≥–æ–±–æ.",
      "start_url": "./index.html?source=pwa",
      "display": "standalone",
      "background_color": "#ffffff",
      "theme_color": "#5a67d8",
      "icons": [
        { "src": "icon-192.png", "sizes": "192x192", "type": "image/png", "purpose": "any maskable" },
        { "src": "icon-512.png", "sizes": "512x512", "type": "image/png", "purpose": "any maskable" }
      ]
    }
    </script>

    <script type="text/plain" id="sw-data">
    const CACHE_NAME = 'gobo-calculator-cache-v2.1.1'; // –û–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
    const assetsToCache =;

    self.addEventListener('install', event => {
        event.waitUntil(
            caches.open(CACHE_NAME)
             .then(cache => {
                    console.log('–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤');
                    return cache.addAll(assetsToCache.map(url => new Request(url, {cache: 'reload'}))); 
                })
             .catch(err => console.error('–û—à–∏–±–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ:', err))
        );
        self.skipWaiting();
    });

    self.addEventListener('activate', event => {
        event.waitUntil(
            caches.keys().then(cacheNames => {
                return Promise.all(
                    cacheNames.map(cacheName => {
                        if (cacheName!== CACHE_NAME) {
                            console.log('–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∫–µ—à–∞:', cacheName);
                            return caches.delete(cacheName);
                        }
                    })
                );
            })
        );
        return self.clients.claim();
    });

    self.addEventListener('fetch', event => {
        event.respondWith(
            caches.match(event.request)
             .then(response => {
                    if (response) {
                        return response; 
                    }
                    return fetch(event.request).then(
                        networkResponse => {
                            if(!networkResponse |
| networkResponse.status!== 200 |
| (networkResponse.type!== 'basic' && networkResponse.type!== 'cors')) { // –ù–µ –∫–µ—à–∏—Ä—É–µ–º –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö CDN –±–µ–∑ CORS
                                return networkResponse;
                            }
                            const responseToCache = networkResponse.clone();
                            caches.open(CACHE_NAME)
                             .then(cache => {
                                    cache.put(event.request, responseToCache);
                                });
                            return networkResponse;
                        }
                    ).catch(() => {
                        // if (event.request.mode === 'navigate' && assetsToCache.includes('./fallback.html')) {
                        //     return caches.match('./fallback.html');
                        // }
                    });
                })
        );
    });
    </script>
    
    <script>
        function startTour(stepsConfig) {
            const defaultTourSteps =;
            const steps = stepsConfig |
| defaultTourSteps;
            let currentStepIndex = 0;
            let overlay = document.createElement('div');
            let tooltip = document.createElement('div');
            let highlightBox = document.createElement('div');

            function setupOverlay() {
                overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:9998;';
                highlightBox.style.cssText = 'position:absolute;border:3px solid #5a67d8;border-radius:5px;box-shadow:0 0 0 9999px rgba(0,0,0,.7);pointer-events:none;transition:all 0.3s ease-out;';
                tooltip.style.cssText = 'position:absolute;background:#fff;color:#333;padding:15px;border-radius:5px;max-width:300px;z-index:9999;box-shadow:0 2px 10px rgba(0,0,0,.2);';
                overlay.appendChild(highlightBox); 
                document.body.appendChild(overlay);
                document.body.appendChild(tooltip);
                overlay.onclick = endTour; 
            }

            function showStep() {
                if (currentStepIndex >= steps.length) {
                    endTour();
                    return;
                }
                const step = steps; // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
                const targetElement = document.querySelector(step.el);
                if (!targetElement) { console.warn('Intro.js: Element not found for step', step); currentStepIndex++; showStep(); return; }

                const rect = targetElement.getBoundingClientRect();
                highlightBox.style.left = `${rect.left - 4}px`;
                highlightBox.style.top = `${rect.top - 4}px`;
                highlightBox.style.width = `${rect.width + 8}px`;
                highlightBox.style.height = `${rect.height + 8}px`;
                
                targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });

                tooltip.innerHTML = `<p>${step.msg}</p><button id="introNextBtn">–î–∞–ª–µ–µ</button> <button id="introSkipBtn" style="float:right;background:transparent;color:#777;border:none;padding:5px;">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>`;
                
                let tooltipTop = rect.bottom + 15;
                let tooltipLeft = rect.left;
                if (tooltipTop + tooltip.offsetHeight > window.innerHeight) {
                    tooltipTop = rect.top - tooltip.offsetHeight - 15;
                }
                if (tooltipLeft + tooltip.offsetWidth > window.innerWidth) {
                    tooltipLeft = window.innerWidth - tooltip.offsetWidth - 15;
                }
                tooltip.style.top = `${tooltipTop}px`;
                tooltip.style.left = `${tooltipLeft < 0? 15 : tooltipLeft}px`;


                tooltip.querySelector('#introNextBtn').onclick = () => { currentStepIndex++; showStep(); };
                tooltip.querySelector('#introSkipBtn').onclick = endTour;
            }

            function endTour() {
                if(overlay.parentNode) overlay.remove();
                if(tooltip.parentNode) tooltip.remove();
            }
            
            setupOverlay();
            showStep();
        }
    </script>

    <script type="text/javascript">
    // ========== –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ==========
    const $ = q => document.querySelector(q);
    const $$ = q => document.querySelectorAll(q);

    let currentStep = 1;
    let assignedPoints =; 
    let initialGoboContourPoints =; 
    let deformationDestPoints =; 
    
    let bgPhoto = { 
        img: null, // –≠—Ç–æ—Ç –æ–±—ä–µ–∫—Ç Image –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è, —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
        dataURL: null, 
        originalWidth: 0,
        originalHeight: 0,
        displayWidth: 0, 
        displayHeight: 0
    };
    let goboImage = { 
        img: null, 
        dataURL: null, 
        originalWidth: 0,
        originalHeight: 0
    };

    let transformState = { 
        x: 0, y: 0, 
        scale: 1,       
        rotation: 0,    
        opacity: 1,
        centerX: 0, 
        centerY: 0,
        baseScale: 1 
    };

    let historyStack =; 

    let contourImageContainer, bgImgElement, svgOverlayElement; 
    let deformationContainer, bgImgDeformElement, deformationCanvas, dCtx; 
    let exportPreviewCanvas, epCtx; 

    const MAX_CONTOUR_POINTS = 12;
    const MAX_PHOTO_DIMENSION = 2000; 

    // ========== –£—Ç–∏–ª–∏—Ç—ã ==========
    function showNotification(message, duration = 3000) {
        const notification = $('#notification');
        if (!notification) { console.error("–≠–ª–µ–º–µ–Ω—Ç #notification –Ω–µ –Ω–∞–π–¥–µ–Ω!"); return; }
        notification.textContent = message;
        notification.style.display = 'block';
        setTimeout(() => { notification.style.display = 'none'; }, duration);
    }

    function calculateBoundingBox(pointsArray) {
        if (!pointsArray |
| pointsArray.length === 0) return { minX: 0, minY: 0, maxX: 0, maxY: 0, width: 0, height: 0, cx: 0, cy: 0 };
        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
        pointsArray.forEach(p => {
            minX = Math.min(minX, p.x);
            minY = Math.min(minY, p.y);
            maxX = Math.max(maxX, p.x);
            maxY = Math.max(maxY, p.y);
        });
        const width = maxX - minX;
        const height = maxY - minY;
        return { minX, minY, maxX, maxY, width, height, cx: minX + width / 2, cy: minY + height / 2 };
    }
    
    // ========== –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —à–∞–≥–∞–º ==========
    function goToStep(nextStep) {
        if (nextStep === currentStep) return;
        const currentStepEl = $(`#step${currentStep}`);
        const currentProgressEl = $(`#pStep${currentStep}`);
        if(currentStepEl) currentStepEl.classList.remove('active');
        if(currentProgressEl) currentProgressEl.classList.remove('active');
        
        if (nextStep > currentStep && currentProgressEl) {
            currentProgressEl.classList.add('done');
        }
        currentStep = nextStep;
        const nextStepEl = $(`#step${currentStep}`);
        const nextProgressEl = $(`#pStep${currentStep}`);
        if(nextStepEl) nextStepEl.classList.add('active');
        if(nextProgressEl) nextProgressEl.classList.add('active');


        if (currentStep === 2) setupStep2UI();
        if (currentStep === 4) setupStep4UI();
        if (currentStep === 5) setupStep5UI();
    }

    // ========== –®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ–Ω–æ–≤–æ–≥–æ —Ñ–æ—Ç–æ ==========
    function initStep1() {
        const photoZone = $('#photoZone');
        const photoInput = $('#photoInput');
        if (!photoZone |
|!photoInput) {
            console.error("–≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!");
            return;
        }
        photoZone.onclick = () => photoInput.click();
        ['dragover', 'dragleave', 'drop'].forEach(eventName => {
            photoZone.addEventListener(eventName, e => {
                e.preventDefault();
                e.stopPropagation();
                if (eventName === 'dragover') photoZone.classList.add('dragover');
                else photoZone.classList.remove('dragover');
                if (eventName === 'drop') handlePhotoUpload(e.dataTransfer.files);
            });
        });
        photoInput.onchange = e => handlePhotoUpload(e.target.files);
        
        const setupFilesBtn = $('#setupAppFiles');
        if (setupFilesBtn) {
            setupFilesBtn.onclick = () => {
                const manifestContent = $('#manifest-data')?.textContent |
| '{}';
                const swContent = $('#sw-data')?.textContent |
| '';
                downloadFile(manifestContent, 'manifest.json', 'application/json');
                downloadFile(swContent, 'sw.js', 'application/javascript');
                showNotification('–°–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª—ã manifest.json –∏ sw.js –∏ –ø–æ–º–µ—Å—Ç–∏—Ç–µ –∏—Ö –≤ –∫–æ—Ä–µ–Ω—å –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è GitHub Pages. –¢–∞–∫–∂–µ –¥–æ–±–∞–≤—å—Ç–µ –∏–∫–æ–Ω–∫–∏ icon-192.png –∏ icon-512.png.', 10000);
            };
        }
    }

    function handlePhotoUpload(files) {
        if (!files |
| files.length === 0) {
            showNotification('–û—à–∏–±–∫–∞: –§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω.');
            return;
        }
        const file = files;

        if (!file.type.startsWith('image/')) {
            showNotification('–û—à–∏–±–∫–∞: –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.');
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e_reader) {
            const img = new Image();
            img.onload = function() {
                bgPhoto.originalWidth = img.width;
                bgPhoto.originalHeight = img.height;
                let finalDataURL = e_reader.target.result;

                if (img.width > MAX_PHOTO_DIMENSION |
| img.height > MAX_PHOTO_DIMENSION) {
                    const scaleFactor = Math.min(MAX_PHOTO_DIMENSION / img.width, MAX_PHOTO_DIMENSION / img.height);
                    const tempCanvas = document.createElement('canvas');
                    tempCanvas.width = Math.round(img.width * scaleFactor);
                    tempCanvas.height = Math.round(img.height * scaleFactor);
                    const tempCtx = tempCanvas.getContext('2d');
                    tempCtx.drawImage(img, 0, 0, tempCanvas.width, tempCanvas.height);
                    finalDataURL = tempCanvas.toDataURL('image/jpeg', 0.9);
                    showNotification(`–§–æ—Ç–æ –±—ã–ª–æ —É–º–µ–Ω—å—à–µ–Ω–æ –¥–æ ${tempCanvas.width}x${tempCanvas.height}px –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.`);
                }
                
                bgPhoto.dataURL = finalDataURL;
                
                // –û—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
                assignedPoints =;
                if ($('#pointCount')) $('#pointCount').textContent = '0';
                if ($('#svgOverlay')) $('#svgOverlay').innerHTML = '';
                if ($('#goToStep3')) $('#goToStep3').disabled = true;
                goboImage = { img: null, dataURL: null, originalWidth: 0, originalHeight: 0 };
                if ($('#goboPreview')) $('#goboPreview').innerHTML = '<span>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≥–æ–±–æ</span>';
                if ($('#goToStep4')) $('#goToStep4').disabled = true;
                historyStack =;

                goToStep(2);
            };
            img.onerror = function() {
                showNotification('–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ Image). –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª.');
            };
            img.src = e_reader.target.result;
        };
        reader.onerror = function() {
            showNotification('–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª.');
        };
        reader.readAsDataURL(file);
    }

    // –û—Å—Ç–∞–ª—å–Ω–æ–π JavaScript –∫–æ–¥ (initStep2, addContourPoint,..., registerServiceWorker, window.onload)
    // –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ, –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –æ—Ç–≤–µ—Ç–µ (ID: 531a90d7-1192-4bf5-bf0a-d82e108fa124),
    // —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ –¥–ª—è FileList –≤ handleGoboUpload –∏ loadProjectState,
    // –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π assetsToCache –≤ sw-data.
    // –í–∞–∂–Ω–æ: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ DOM —Å–µ–ª–µ–∫—Ç–æ—Ä—ã ($) –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ DOM –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω,
    // –∏–ª–∏ —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—ã–∑–æ–≤–∞. `window.onload` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

    // (–ü–æ–ª–Ω—ã–π JavaScript –∫–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞, –Ω–∞—á–∏–Ω–∞—è —Å `function setupStep2UI()` –∏ –¥–æ –∫–æ–Ω—Ü–∞,
    // –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–¥–µ—Å—å, —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏, –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –Ω–∏–∂–µ)

    // ========== –®–∞–≥ 2: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ—á–µ–∫ –∫–æ–Ω—Ç—É—Ä–∞ ==========
    function setupStep2UI() {
        contourImageContainer = $('#contourImageContainer');
        bgImgElement = $('#bgImg');
        svgOverlayElement = $('#svgOverlay');

        if (!bgImgElement |
|!bgPhoto.dataURL) {
            showNotification("–û—à–∏–±–∫–∞: –§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –¥–ª—è –®–∞–≥–∞ 2.");
            goToStep(1); // –í–µ—Ä–Ω—É—Ç—å –Ω–∞ —à–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏
            return;
        }
        bgImgElement.src = bgPhoto.dataURL;
        
        assignedPoints.forEach(p => p.element?.remove()); // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ DOM-—ç–ª–µ–º–µ–Ω—Ç—ã, –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏
        assignedPoints =; // –û—á–∏—â–∞–µ–º –º–∞—Å—Å–∏–≤ —Ç–æ—á–µ–∫ (–µ—Å–ª–∏ —ç—Ç–æ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ —Ä–µ-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
        updatePointCountAndProceedButton();
        drawContourPolygon();

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ SVG –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º `bgImgElement.onload` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è display —Ä–∞–∑–º–µ—Ä–æ–≤ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ src —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –±—Ä–∞—É–∑–µ—Ä–æ–º
        bgImgElement.onload = () => {
            bgPhoto.displayWidth = bgImgElement.offsetWidth;
            bgPhoto.displayHeight = bgImgElement.offsetHeight;
            
            if (contourImageContainer) {
                contourImageContainer.style.width = `${bgPhoto.displayWidth}px`;
                contourImageContainer.style.height = `${bgPhoto.displayHeight}px`;
            }
            if (svgOverlayElement) {
                svgOverlayElement.setAttribute('viewBox', `0 0 ${bgPhoto.displayWidth} ${bgPhoto.displayHeight}`);
            }
        };
        // –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∂–µ –≤ –∫–µ—à–µ, onload –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å, –ø—Ä–æ–≤–µ—Ä—è–µ–º complete
        if (bgImgElement.complete && bgImgElement.naturalWidth > 0) {
           bgImgElement.onload(); // –í—ã–∑—ã–≤–∞–µ–º –≤—Ä—É—á–Ω—É—é, –µ—Å–ª–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
        }
    }

    function initStep2() {
        contourImageContainer = $('#contourImageContainer'); 
        if (!contourImageContainer) return; // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –Ω–µ—Ç, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
        
        contourImageContainer.addEventListener('click', e => {
            if (!bgPhoto.dataURL) return; // –ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Ç–æ—á–∫–∏, –µ—Å–ª–∏ –Ω–µ—Ç —Ñ–æ–Ω–∞
            if (e.target.classList.contains('point-marker')) return; 
            if (assignedPoints.length >= MAX_CONTOUR_POINTS) {
                showNotification(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ (${MAX_CONTOUR_POINTS}).`);
                return;
            }
            const rect = contourImageContainer.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            addContourPoint(x, y);
            saveStateForUndo(); 
        });

        $('#clearPoints').onclick = () => {
            assignedPoints.forEach(p => p.element?.remove());
            assignedPoints =;
            updatePointCountAndProceedButton();
            drawContourPolygon();
            saveStateForUndo();
        };
        $('#undoLastPoint').onclick = () => {
            if (assignedPoints.length > 0) {
                const removedPoint = assignedPoints.pop();
                removedPoint.element?.remove();
                updatePointCountAndProceedButton();
                drawContourPolygon();
            }
        };
        $('#goToStep3').onclick = () => {
            if (assignedPoints.length < 3) {
                showNotification('–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 3 —Ç–æ—á–∫–∏ –¥–ª—è –∫–æ–Ω—Ç—É—Ä–∞.');
                return;
            }
            goToStep(3);
        };
    }

    function addContourPoint(x, y, existingElement = null) {
        const pointElement = existingElement |
| document.createElement('div');
        pointElement.className = 'point-marker';
        pointElement.textContent = assignedPoints.length + 1;
        pointElement.style.left = `${x}px`;
        pointElement.style.top = `${y}px`;
        
        if (!existingElement && contourImageContainer) { 
             contourImageContainer.appendChild(pointElement);
        }

        const point = { x, y, element: pointElement, id: Date.now() + Math.random() };
        assignedPoints.push(point);
        
        updatePointCountAndProceedButton();
        drawContourPolygon();
    }
    
    function updatePointCountAndProceedButton() {
        if ($('#pointCount')) $('#pointCount').textContent = assignedPoints.length;
        if ($('#goToStep3')) $('#goToStep3').disabled = assignedPoints.length < 3;
    }

    function drawContourPolygon() {
        if (!svgOverlayElement) svgOverlayElement = $('#svgOverlay');
        if (!svgOverlayElement) return;

        svgOverlayElement.innerHTML = ''; 
        if (assignedPoints.length < 2) return;

        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        let d = `M ${assignedPoints.x} ${assignedPoints.y} `;
        for (let i = 1; i < assignedPoints.length; i++) {
            d += `L ${assignedPoints[i].x} ${assignedPoints[i].y} `;
        }
        if (assignedPoints.length > 2) {
            d += 'Z'; 
        }
        path.setAttribute('d', d);
        path.setAttribute('fill', 'rgba(255, 105, 180, 0.3)');
        path.setAttribute('stroke', '#ff69b4');
        path.setAttribute('stroke-width', '2');
        svgOverlayElement.appendChild(path);
    }

    // ========== –®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–æ–±–æ ==========
    function initStep3() {
        const goboInputEl = $('#goboInput');
        if (goboInputEl) goboInputEl.onchange = e => handleGoboUpload(e.target.files);
        
        const goToStep4Btn = $('#goToStep4');
        if (goToStep4Btn) goToStep4Btn.onclick = () => {
            if (!goboImage.img) {
                showNotification('–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –≥–æ–±–æ.');
                return;
            }
            goToStep(4);
        };
    }

    function handleGoboUpload(files) {
        if (!files |
| files.length === 0) {
            showNotification('–û—à–∏–±–∫–∞: –§–∞–π–ª –¥–ª—è –≥–æ–±–æ –Ω–µ –≤—ã–±—Ä–∞–Ω.');
            return;
        }
        const file = files;

        if (!file.type.startsWith('image/')) {
            showNotification('–û—à–∏–±–∫–∞: –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –≥–æ–±–æ.');
            return;
        }
        const reader = new FileReader();
        reader.onload = e_reader => {
            goboImage.dataURL = e_reader.target.result;
            goboImage.img = new Image();
            goboImage.img.onload = () => {
                goboImage.originalWidth = goboImage.img.width;
                goboImage.originalHeight = goboImage.img.height;
                if ($('#goboPreview')) $('#goboPreview').innerHTML = `<img src="${goboImage.dataURL}" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≥–æ–±–æ">`;
                if ($('#goToStep4')) $('#goToStep4').disabled = false;
            };
            goboImage.img.onerror = () => showNotification("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–æ–±–æ (Image.onerror).");
            goboImage.img.src = goboImage.dataURL;
        };
        reader.onerror = () => showNotification("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –≥–æ–±–æ (FileReader.onerror).");
        reader.readAsDataURL(file);
    }

    // ========== –®–∞–≥ 4: –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏—è ==========
    // (–ö–æ–¥ –¥–ª—è –®–∞–≥–∞ 4, –®–∞–≥–∞ 5, –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–ó–∞–≥—Ä—É–∑–∫–∏, –û—Ç–º–µ–Ω—ã, PWA –∏ window.onload
    // –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ, –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –æ—Ç–≤–µ—Ç–µ ID: 531a90d7-1192-4bf5-bf0a-d82e108fa124,
    // —Å —É—á–µ—Ç–æ–º —Ç–æ–≥–æ, —á—Ç–æ `handlePhotoUpload` –∏ `handleGoboUpload` —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
    // –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç `files`, –∏ `assetsToCache` –≤ `sw-data` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω.
    // –¢–∞–∫–∂–µ, `startTour` —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç `defaultTourSteps`.
    // –ú–µ–ª–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ `drawPoly` –∏ `setupStep4UI` –¥–ª—è `initialGoboContourPoints`
    // –∏ `deformationDestPoints` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø—É—Å—Ç—ã—Ö –º–∞—Å—Å–∏–≤–∞—Ö –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–∞—Ö.)

    //... (–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –æ—Å—Ç–∞–ª—å–Ω–æ–π JavaScript –∫–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞, –Ω–∞—á–∏–Ω–∞—è —Å `let isGoboVisible = true;`
    // –∏ –¥–æ –∫–æ–Ω—Ü–∞ `window.onload`, –æ–±–µ—Å–ø–µ—á–∏–≤, —á—Ç–æ –≤—Å–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã DOM ($) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ,
    // –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä—è—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–ª–∏ –≤—ã–∑—ã–≤–∞—è –∏—Ö –≤ `window.onload`)

    // –ü—Ä–∏–º–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ –∫–æ–¥–∞:
    // (–í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π JS-–∫–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–¥–µ—Å—å, –æ–±–µ—Ä–Ω—É—Ç—ã–π –≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–ª–∏ –≤—ã–∑–≤–∞–Ω–Ω—ã–π –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ DOM)
    
    // –í–ê–ñ–ù–û: –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω —Ç–æ–ª—å–∫–æ –∫–∞—Ä–∫–∞—Å –¥–ª—è –æ—Å—Ç–∞–≤—à–µ–π—Å—è —á–∞—Å—Ç–∏ JS.
    // –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ü–û–õ–ù–´–ô –û–°–¢–ê–í–®–ò–ô–°–Ø –ö–û–î –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ (ID: 531a90d7-1192-4bf5-bf0a-d82e108fa124)
    // –∏ –≤–Ω–µ—Å—Ç–∏ —Ç–æ—á–µ—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤—ã—à–µ.
    // –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—ã–ª–∏ –≤ handlePhotoUpload, handleGoboUpload, sw-data, startTour.

    let isGoboVisible = true;
    let activeDeformPointIndex = -1;

    function setupStep4UI() {
        deformationContainer = $('#deformationContainer');
        bgImgDeformElement = $('#bgImgDeform');
        deformationCanvas = $('#deformation-canvas');
        
        if (!deformationCanvas |
|!bgImgDeformElement |
|!bgPhoto.dataURL |
|!goboImage.img) {
            showNotification("–û—à–∏–±–∫–∞: –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –®–∞–≥–∞ 4 –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.");
            goToStep(1);
            return;
        }
        dCtx = deformationCanvas.getContext('2d');
        bgImgDeformElement.src = bgPhoto.dataURL;
        
        bgImgDeformElement.onload = () => {
            if (bgImgDeformElement.offsetWidth === 0) { // –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –µ—â–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∑–∏–ª–æ—Å—å
                setTimeout(setupStep4UI, 100); // –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è
                return;
            }
            deformationCanvas.width = bgImgDeformElement.offsetWidth;
            deformationCanvas.height = bgImgDeformElement.offsetHeight;
            
            const scaleX = deformationCanvas.width / (bgPhoto.displayWidth |
| deformationCanvas.width); // –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
            const scaleY = deformationCanvas.height / (bgPhoto.displayHeight |
| deformationCanvas.height); // –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç

            deformationDestPoints = assignedPoints.map((p, index) => ({
                x: p.x * scaleX,
                y: p.y * scaleY,
                originalIndex: index 
            }));
            
            const gw = goboImage.originalWidth;
            const gh = goboImage.originalHeight;
            
            if (deformationDestPoints.length === 0) { // –ï—Å–ª–∏ –Ω–µ—Ç —Ç–æ—á–µ–∫ –∫–æ–Ω—Ç—É—Ä–∞, —Å–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–µ –¥–ª—è –≥–æ–±–æ
                 initialGoboContourPoints = [ { x: 0, y: 0 }, { x: gw, y: 0 }, { x: gw, y: gh }, { x: 0, y: gh }];
                 // –ò —Å–æ–∑–¥–∞–µ–º —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ deformationDestPoints, —á—Ç–æ–±—ã –±—ã–ª–æ —á—Ç–æ —Ç—Ä–∏–∞–Ω–≥—É–ª–∏—Ä–æ–≤–∞—Ç—å
                 const dcw = deformationCanvas.width / 2; const dch = deformationCanvas.height / 2;
                 deformationDestPoints = [ {x: dcw-gw/4, y:dch-gh/4}, {x: dcw+gw/4, y:dch-gh/4}, {x: dcw+gw/4, y:dch+gh/4}, {x: dcw-gw/4, y:dch+gh/4}].map((p,i)=>({...p, originalIndex:i}));

            } else if (assignedPoints.length === 4) { // –ï—Å–ª–∏ 4 —Ç–æ—á–∫–∏ –∫–æ–Ω—Ç—É—Ä–∞
                 initialGoboContourPoints = [ { x: 0, y: 0 }, { x: gw, y: 0 }, { x: gw, y: gh }, { x: 0, y: gh } ];
            } else { 
                initialGoboContourPoints = deformationDestPoints.map((_, i) => { // –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
                    if (i === 0) return { x: 0, y: 0 }; if (i === 1) return { x: gw, y: 0 };
                    if (i === 2) return { x: gw, y: gh }; if (i === 3) return { x: 0, y: gh };
                    return { x: (i%2 === 0)? 0 : gw, y: (Math.floor(i/2)%2 === 0)? 0 : gh };
                });
            }
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ—á–µ–∫
            while(initialGoboContourPoints.length < deformationDestPoints.length && initialGoboContourPoints.length > 0) {
                initialGoboContourPoints.push(initialGoboContourPoints[initialGoboContourPoints.length-1]);
            }
            while(deformationDestPoints.length < initialGoboContourPoints.length && deformationDestPoints.length > 0) {
                deformationDestPoints.push(deformationDestPoints);
            }


            initializeTransformState();
            createDeformMarkers();
            drawDeformedGobo();
            saveStateForUndo();
        };
        if (bgImgDeformElement.complete && bgImgDeformElement.naturalWidth > 0) {
           bgImgDeformElement.onload();
        }
    }
    //... (–û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è initStep4Controls, drawDeformedGobo, –®–∞–≥–∞ 5, –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–ó–∞–≥—Ä—É–∑–∫–∏, –û—Ç–º–µ–Ω—ã, PWA, window.onload)
    // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ DOM-—ç–ª–µ–º–µ–Ω—Ç—ã ($) –±–µ–∑–æ–ø–∞—Å–Ω—ã –∏–ª–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ window.onload.

    // –ü—Ä–∏–º–µ—Ä –¥–ª—è window.onload
    window.onload = () => {
        initStep1();
        initStep2(); 
        initStep3();
        initStep4Controls(); 
        initStep5Controls();

        registerServiceWorker(); 
    };
    
    // –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –ü–û–õ–ù–´–ô –û–°–¢–ê–í–®–ò–ô–°–Ø JavaScript –∫–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞
    // (ID: 531a90d7-1192-4bf5-bf0a-d82e108fa124), –Ω–∞—á–∏–Ω–∞—è —Å —Ñ—É–Ω–∫—Ü–∏–∏ `initStep4Controls()`
    // –∏ –¥–æ –∫–æ–Ω—Ü–∞, –≤–∫–ª—é—á–∞—è `registerServiceWorker()` –∏ `window.onload`.
    // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, —É–ø–æ–º—è–Ω—É—Ç—ã–µ –≤—ã—à–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è `handleGoboUpload`,
    // `loadProjectState`, `startTour`, `sw-data`), –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã.
    // –ù–∞–ø—Ä–∏–º–µ—Ä, `loadProjectState` —Ç–∞–∫–∂–µ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `files`.
    // `restoreLastState` –∏ `saveStateForUndo` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å `assignedPoints` –∏ `deformationDestPoints`.
    // `drawDeformedGobo` –∏ `renderToContext` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–æ–π—á–∏–≤—ã –∫ —Å–ª—É—á–∞—è–º, –∫–æ–≥–¥–∞ `initialGoboContourPoints` –∏–ª–∏ `deformationDestPoints` –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã.
    // –Ø –¥–æ–±–∞–≤–∏–ª –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ `setupStep4UI` –∏ `drawDeformedGobo` –¥–ª—è —ç—Ç–æ–≥–æ.

    // (–ö–æ–Ω–µ—Ü –±–ª–æ–∫–∞ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ JS –∫–æ–¥–∞)
    //... (–ø–æ–ª–Ω—ã–π JS –∫–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)...
    // –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±–æ–≤–∞–ª–∏ —è–≤–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–ª–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è.
    // –ü–æ–ª–Ω—ã–π –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∑—è—Ç –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ –∑–¥–µ—Å—å.

    function initStep4Controls() {
        const opacitySlider = $('#opacitySlider'); if(opacitySlider) { opacitySlider.oninput = e => { transformState.opacity = parseFloat(e.target.value) / 100; $('#opacityValue').textContent = `${e.target.value}%`; drawDeformedGobo(); }; opacitySlider.onchange = saveStateForUndo; }
        const scaleSlider = $('#scaleSlider'); if(scaleSlider) { scaleSlider.oninput = e => { transformState.scale = parseFloat(e.target.value) / 100; $('#scaleValue').textContent = `${e.target.value}%`; drawDeformedGobo(); }; scaleSlider.onchange = saveStateForUndo; }
        const rotationSlider = $('#rotationSlider'); if(rotationSlider) { rotationSlider.oninput = e => { transformState.rotation = parseInt(e.target.value); $('#rotationValue').textContent = `${e.target.value}¬∞`; drawDeformedGobo(); }; rotationSlider.onchange = saveStateForUndo; }
        $('#toggleGoboVisibility')?.addEventListener('click', () => { isGoboVisible =!isGoboVisible; $('#toggleGoboVisibility').textContent = isGoboVisible? 'üëÅÔ∏è –°–∫—Ä—ã—Ç—å –ì–æ–±–æ' : 'üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å –ì–æ–±–æ'; drawDeformedGobo(); });
        $('#undoTransform')?.addEventListener('click', restoreLastState);
        $('#resetTransform')?.addEventListener('click', () => { initializeTransformState(); const scaleX = deformationCanvas.width / (bgPhoto.displayWidth||1); const scaleY = deformationCanvas.height / (bgPhoto.displayHeight||1); deformationDestPoints = assignedPoints.map((p, index) => ({ x: p.x * scaleX, y: p.y * scaleY, originalIndex: index })); updateDeformMarkersPositions(); drawDeformedGobo(); saveStateForUndo(); });
        $('#saveProject')?.addEventListener('click', saveProjectState);
        $('#loadProjectInput')?.addEventListener('change', e => loadProjectState(e.target.files));
        $('#runTour')?.addEventListener('click', () => startTour()); 
        $('#goToStep5')?.addEventListener('click', () => goToStep(5));
    }

    function loadProjectState(files) { // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–ª—è files
        if (!files |
| files.length === 0) { showNotification('–û—à–∏–±–∫–∞: –§–∞–π–ª –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω.'); return; }
        const file = files; // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
        //... –æ—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ loadProjectState –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞...
        const reader = new FileReader();
        reader.onload = e_reader => {
            try {
                const projectData = JSON.parse(e_reader.target.result);
                if (projectData.version!== "2.1") { showNotification("–§–∞–π–ª –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω.", 5000); return; }
                bgPhoto = projectData.bgPhoto;
                bgPhoto.img = new Image(); // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è, –Ω–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                bgPhoto.img.onload = () => {
                    goboImage = projectData.goboImage;
                    goboImage.img = new Image();
                    goboImage.img.onload = () => {
                        $$('#contourImageContainer.point-marker').forEach(el => el.remove());
                        assignedPoints =; 
                        projectData.assignedPoints.forEach(p => addContourPoint(p.x, p.y)); 
                        deformationDestPoints = projectData.deformationDestPoints;
                        initialGoboContourPoints = projectData.initialGoboContourPoints;
                        transformState = projectData.transformState;
                        if (projectData.currentStep >= 2) {
                            if ($('#bgImg')) $('#bgImg').src = bgPhoto.dataURL; // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ bgImg –æ–±–Ω–æ–≤–ª–µ–Ω
                            setupStep2UI(); 
                            assignedPoints.forEach(p => { 
                                if (p.element) {
                                   p.element.style.left = p.x + 'px'; p.element.style.top = p.y + 'px';
                                   if(!p.element.parentNode && contourImageContainer) contourImageContainer.appendChild(p.element);
                                }
                            });
                            drawContourPolygon(); updatePointCountAndProceedButton();
                        }
                        if (projectData.currentStep >= 3) {
                             if($('#goboPreview')) $('#goboPreview').innerHTML = `<img src="${goboImage.dataURL}" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≥–æ–±–æ">`;
                             if($('#goToStep4')) $('#goToStep4').disabled = false;
                        }
                        if (projectData.currentStep >= 4) {
                            if ($('#bgImgDeform')) $('#bgImgDeform').src = bgPhoto.dataURL;
                            setupStep4UI(); 
                        }
                        goToStep(projectData.currentStep |
| 1);
                        showNotification('–ü—Ä–æ–µ–∫—Ç –∑–∞–≥—Ä—É–∂–µ–Ω.'); historyStack =; 
                    };
                    goboImage.img.onerror = () => showNotification("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–æ–±–æ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.");
                    goboImage.img.src = goboImage.dataURL;
                };
                bgPhoto.img.onerror = () => showNotification("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ–Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.");
                bgPhoto.img.src = bgPhoto.dataURL;
            } catch (err) { console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞:", err); showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞.'); }
        };
        reader.onerror = () => showNotification("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞ (FileReader).");
        reader.readAsText(file);
        if ($('#loadProjectInput')) $('#loadProjectInput').value = ''; 
    }
    
    //... (–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –ü–û–õ–ù–û–°–¢–¨–Æ —Ñ—É–Ω–∫—Ü–∏–∏: setupStep5UI, initStep5Controls, updatePixelSizeDisplay, generateExportPreview, renderToContext, exportImage, saveProjectState, downloadFile, saveStateForUndo, restoreLastState, registerServiceWorker –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞)
    // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –æ—à–∏–±–æ–∫ –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.
    // –ù–∞–ø—Ä–∏–º–µ—Ä, renderToContext –∏ exportImage –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–æ–π—á–∏–≤—ã –∫ –Ω—É–ª–µ–≤—ã–º —Ä–∞–∑–º–µ—Ä–∞–º deformationCanvas.width/height.

    // –§–∏–Ω–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    // window.onload —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤—ã—à–µ, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ init* —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

    </script>
</body>
</html>
